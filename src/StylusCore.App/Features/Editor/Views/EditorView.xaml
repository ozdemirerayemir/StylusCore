<Page x:Class="StylusCore.App.Features.Editor.Views.EditorView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="clr-namespace:StylusCore.App.Controls"
      xmlns:engine="clr-namespace:StylusCore.Engine.Wpf.Controls;assembly=StylusCore.Engine.Wpf"
      Title="Editor"
      Background="{DynamicResource Brush.ContentBg}">

    <Page.Resources>
        <!-- Use centralized styles directly or create thin wrappers if needed -->
    </Page.Resources>

    <!-- MAIN EDITOR LAYOUT -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Row 0: Ribbon -->
            <RowDefinition Height="*"/>    <!-- Row 1: Workspace -->
        </Grid.RowDefinitions>
        
        <!-- ROW 0: RIBBON (Editor Context Only) -->
        <Border Grid.Row="0"
                Background="{DynamicResource Brush.AppBg}"
                BorderBrush="{DynamicResource Brush.BorderHard}"
                BorderThickness="0,0,0,1"
                Padding="8,4"
                Visibility="{Binding IsRibbonVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Ribbon Content -->
                <StackPanel Grid.Column="0" Orientation="Horizontal"
                            Visibility="{Binding IsRibbonFull, Converter={StaticResource BoolToVisibilityConverter}}">
                    <!-- Group: Selection -->
                    <StackPanel Orientation="Horizontal" Margin="{DynamicResource Sidebar.TextMargin}">
                        <!-- Select Tool -->
                        <Button ToolTip="{DynamicResource Str_Tooltip_Select}" Style="{DynamicResource IconButtonStyle}" 
                                Width="{DynamicResource Height_Button_Standard}" Height="{DynamicResource Height_Button_Standard}" 
                                Command="{Binding SelectToolCommand}">
                            <Path Data="{StaticResource Icon.Select}" Style="{DynamicResource IconBase}"/>
                        </Button>
                        <!-- Lasso Select -->
                        <Button ToolTip="{DynamicResource Str_Tooltip_Lasso}" Style="{DynamicResource IconButtonStyle}" 
                                Width="{DynamicResource Height_Button_Standard}" Height="{DynamicResource Height_Button_Standard}" 
                                Margin="{DynamicResource Margin_Small}">
                            <Path Data="{StaticResource Icon.Lasso}" Style="{DynamicResource IconBase}"/>
                        </Button>
                    </StackPanel>

                    <!-- Divider -->
                    <Rectangle Width="1" Fill="{DynamicResource Brush.BorderHard}" Margin="8,8,16,8"/>

                    <!-- Group: Tools -->
                    <StackPanel Orientation="Horizontal">
                        <!-- Pen -->
                        <Button Width="{DynamicResource ControlHeightMD}" Height="{DynamicResource ControlHeightMD}" Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_PenBlack}">
                            <Grid>
                                <Path Data="{StaticResource Icon.Pen}" Style="{DynamicResource IconBase}"/>
                                <!-- Color Indicator (TODO: Make Dynamic) -->
                                <Ellipse Width="8" Height="8" Fill="{DynamicResource Brush.TextPrimary}" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,-2,-2"/>
                            </Grid>
                        </Button>
                        <!-- Pen (Red) -->
                        <Button Width="{DynamicResource ControlHeightMD}" Height="{DynamicResource ControlHeightMD}" Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_PenRed}">
                            <Grid>
                                <Path Data="{StaticResource Icon.Pen}" Style="{DynamicResource IconBase}" Stroke="{DynamicResource Brush.Error}"/>
                                <Ellipse Width="8" Height="8" Fill="{DynamicResource Brush.Error}" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,-2,-2"/>
                            </Grid>
                        </Button>
                        <!-- Highlighter -->
                        <Button Width="{DynamicResource ControlHeightMD}" Height="{DynamicResource ControlHeightMD}" Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_Highlighter}">
                            <Path Data="{StaticResource Icon.Highlighter}" Style="{DynamicResource IconBase}" Stroke="{DynamicResource Brush.Accent}" Fill="{DynamicResource Brush.Accent}"/>
                        </Button>
                        <!-- Eraser -->
                        <Button Width="{DynamicResource ControlHeightMD}" Height="{DynamicResource ControlHeightMD}" Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_Eraser}">
                            <Path Data="{StaticResource Icon.Eraser}" Style="{DynamicResource IconBase}"/>
                        </Button>
                    </StackPanel>

                    <!-- Divider -->
                    <Rectangle Width="1" Fill="{DynamicResource Brush.BorderHard}" Margin="16,8,16,8"/>

                    <!-- Group: Shapes -->
                    <StackPanel Orientation="Horizontal">
                        <!-- Rect -->
                        <Button Width="{DynamicResource Height_Button_Standard}" Height="{DynamicResource Height_Button_Standard}" 
                                Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_Rect}">
                            <Path Data="{StaticResource Icon.Rectangle}" Style="{DynamicResource IconBase}"/>
                        </Button>
                    </StackPanel>

                    <!-- Group: Ink to Shape -->
                    <Button Width="{DynamicResource Height_Button_Standard}" Height="{DynamicResource Height_Button_Standard}" 
                            Margin="{DynamicResource Margin_Small}" Style="{DynamicResource IconButtonStyle}" ToolTip="{DynamicResource Str_Tooltip_InkToShape}">
                        <Path Data="{StaticResource Icon.InkToShape}" Style="{DynamicResource IconBase}"/>
                    </Button>
                </StackPanel>

                <!-- Ribbon Display Options (Right Aligned) -->
                <Button Grid.Column="1" 
                        ToolTip="{DynamicResource Str_Tooltip_CycleRibbonMode}" 
                        Style="{DynamicResource IconButtonStyle}"
                        Width="{DynamicResource Height_Button_Standard}" 
                        Height="{DynamicResource Height_Button_Standard}"
                        Command="{Binding CycleRibbonModeCommand}"
                        Margin="0,0,8,0">
                    <Path Data="{StaticResource Icon.ChevronDown}" Style="{DynamicResource IconBase}"/>
                </Button>
            </Grid>
        </Border>

        <!-- ROW 1: WORKSPACE (Sidebar + Canvas) -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
            <!-- Sections Panel (collapsible) -->
            <!-- Width uses StaticResource: ColumnDefinition.Width is GridLength â€” DynamicResource is not supported for GridLength in WPF -->
            <ColumnDefinition x:Name="SectionsPanelColumn" Width="{StaticResource Editor.SectionsPanelDefaultWidth.GL}" MinWidth="{DynamicResource Editor.SectionsPanelMinWidth}" MaxWidth="{DynamicResource Editor.SectionsPanelMaxWidth}"/>
            <!-- GridSplitter -->
            <ColumnDefinition Width="Auto"/>
            <!-- Canvas -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sections Panel -->
        <Border x:Name="SectionsPanel"
                Grid.Column="0"
                Background="{DynamicResource Brush.SidebarBg}"
                BorderBrush="{DynamicResource Brush.BorderSoft}"
                BorderThickness="0,0,1,0">
            <Border.Effect>
                <DropShadowEffect Color="{DynamicResource Color.Shadow}" BlurRadius="10" Opacity="0.05" Direction="0" ShadowDepth="2"/>
            </Border.Effect>

            <Grid ClipToBounds="False">
                <Grid.RowDefinitions>
                    <!-- Header: "Sections" + Collapse Button -->
                    <RowDefinition Height="Auto"/>
                    <!-- Sections List -->
                    <RowDefinition Height="*"/>
                    <!-- Add Buttons -->
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Padding="{DynamicResource Margin_Large}"
                        Background="{DynamicResource Brush.AppBg}"
                        BorderBrush="{DynamicResource Brush.BorderSoft}"
                        BorderThickness="0,0,0,1">
                    <Grid>
                        <TextBlock x:Name="SectionsTitle"
                                   Text="{DynamicResource Str_Editor_Sections}"
                                   FontWeight="{DynamicResource FontWeight_SemiBold}"
                                   FontSize="{DynamicResource FontSize_Body}"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource Brush.TextPrimary}"/>
                        
                        <!-- Collapse/Expand Button -->
                        <Button x:Name="CollapseBtn"
                                HorizontalAlignment="Right"
                                AutomationProperties.Name="{DynamicResource Str_Tooltip_CollapsePanel}"
                                VerticalAlignment="Center"
                                Width="{DynamicResource Size_Icon_Small}" Height="{DynamicResource Size_Icon_Small}"
                                Style="{DynamicResource IconButtonStyle}"
                                ToolTip="{DynamicResource Str_Tooltip_CollapsePanel}"
                                Padding="0"
                                Click="CollapsePanel_Click">
                            <Grid Width="{DynamicResource Size_Icon_Small}" Height="{DynamicResource Size_Icon_Small}">
                                <Path Data="{StaticResource Icon.ChevronLeft}" Style="{DynamicResource IconBase}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Button>
                    </Grid>
                </Border>

                <!-- Sections + Pages List -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel x:Name="SectionsContainer">
                        <!-- Will be populated programmatically -->
                    </StackPanel>
                </ScrollViewer>

                <!-- Add Buttons -->
                <Border x:Name="BottomButtonsBorder"
                        Grid.Row="2"
                        Padding="{DynamicResource Margin_Standard}"
                        Background="{DynamicResource Brush.AppBg}"
                        BorderBrush="{DynamicResource Brush.BorderSoft}"
                        BorderThickness="0,1,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Content="{DynamicResource Str_Editor_AddSection}"
                                Margin="0,0,4,0"
                                Style="{DynamicResource FlatButtonStyle}"
                                Click="AddSection_Click"/>
                        <Button Grid.Column="1"
                                Content="{DynamicResource Str_Editor_AddPage}"
                                Margin="4,0,0,0"
                                Style="{DynamicResource FlatButtonStyle}"
                                Click="AddPage_Click"/>
                    </Grid>
                </Border>

                <!-- Collapsed State Overlay (visible when panel is narrow) -->
                <Border x:Name="CollapsedOverlay"
                        Grid.RowSpan="3"
                        Background="{DynamicResource Brush.SidebarBg}"
                        Visibility="Collapsed">
                    <StackPanel VerticalAlignment="Top"
                                HorizontalAlignment="Center"
                                Margin="0,16">
                        <Button x:Name="ExpandBtn"
                                Width="{DynamicResource Height_Button_Standard}" Height="{DynamicResource Height_Button_Standard}"
                                AutomationProperties.Name="{DynamicResource Str_Tooltip_ExpandPanel}"
                                Style="{DynamicResource IconButtonStyle}"
                                ToolTip="{DynamicResource Str_Tooltip_ExpandPanel}"
                                Padding="0"
                                Click="ExpandPanel_Click">
                            <Grid Width="{DynamicResource Size_Icon_Small}" Height="{DynamicResource Size_Icon_Small}">
                                <Path Data="{StaticResource Icon.ChevronRight}" Style="{DynamicResource IconBase}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- GridSplitter for resizing -->
        <GridSplitter Grid.Column="1"
                      Width="5"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      Background="{DynamicResource Brush.BorderSoft}"
                      Cursor="SizeWE"
                      ShowsPreview="False"
                      DragCompleted="GridSplitter_DragCompleted"/>

        <!-- Drawing Canvas -->
        <engine:CanvasHostControl x:Name="DrawingCanvas"
                                   Grid.Column="2"/>
        </Grid>
    </Grid>
</Page>
