<UserControl x:Class="StylusCore.App.Shared.Components.HeaderControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:StylusCore.App.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="48" d:DesignWidth="800"
             Height="{DynamicResource Shell.HeaderHeight}">

    <!-- Main Header Grid -->
    <Grid Background="Transparent">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/> <!-- 0: Identity (Icon + Title) -->
            <ColumnDefinition Width="*"/>    <!-- 1: Drag Region -->
            <ColumnDefinition Width="Auto"/> <!-- 2: Window Controls -->
        </Grid.ColumnDefinitions>

        <!-- COL 0: IDENTITY (No Drag) -->
        <!-- Visible in Library, App Name Hidden in Editor -->
        <StackPanel Grid.Column="0" 
                    Orientation="Horizontal" 
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    Margin="12,0,0,0">
            
            <!-- App Icon / Logo Placeholder (Non-Interactive) -->
            <Grid Height="32" Width="32" VerticalAlignment="Center">
                <Path Data="{StaticResource Icon.Library}" 
                      Style="{DynamicResource IconBase}"
                      Stretch="Uniform"
                      Width="16" Height="16"
                      Stroke="{DynamicResource Brush.Accent}"
                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>

            <!-- App Name (Visible ONLY when IsEditorActive is FALSE) -->
            <TextBlock Text="{DynamicResource Str_AppName}" 
                       FontSize="{DynamicResource FontSize_Body}"
                       FontWeight="{DynamicResource FontWeight_SemiBold}"
                       VerticalAlignment="Center"
                       Margin="12,0,0,0"
                       Foreground="{DynamicResource Brush.TextPrimary}"
                       Visibility="{Binding IsEditorActive, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
        </StackPanel>

        <!-- COL 1: DRAG REGION (Allow Drag) -->
        <!-- WindowChrome.IsHitTestVisibleInChrome="False" means "Hit test goes to WindowChrome", which handles dragging.
             If we set it to True, the element eats the click and prevents drag.
             So for dragging, we generally want IsHitTestVisibleInChrome="False" on the background/container,
             or just ensure NO element with IsHitTestVisibleInChrome="True" is blocking it.
             Since the WindowChrome declaration in MainWindow covers the whole caption height, 
             clicks on transparent areas fall through to the WindowChrome (Drag).
             The only thing we need to be careful of is NOT putting a "True" element here. 
             We leave this empty or explicitly False. -->
        <Grid Grid.Column="1" Background="Transparent" WindowChrome.IsHitTestVisibleInChrome="False"/>

        <!-- COL 2: WINDOW CONTROLS (No Drag) -->
        <StackPanel Grid.Column="2" 
                    Orientation="Horizontal" 
                    WindowChrome.IsHitTestVisibleInChrome="True"
                    VerticalAlignment="Stretch"
                    HorizontalAlignment="Right">
            <!-- Minimize -->
            <Button Command="{Binding MinimizeCommand}" 
                    Style="{DynamicResource CaptionButtonStyle}"
                    ToolTip="{DynamicResource Str_Tooltip_Minimize}">
                <Grid Width="12" Height="12" IsHitTestVisible="False">
                    <Path Data="{StaticResource Icon.WindowMinimize}" 
                          Style="{StaticResource IconBase}"
                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                </Grid>
            </Button>

            <!-- Maximize / Restore -->
            <Button Command="{Binding MaximizeCommand}" 
                    Style="{DynamicResource CaptionButtonStyle}">
                <Button.ToolTip>
                     <ToolTip Content="{DynamicResource Str_Tooltip_Maximize}"/>
                </Button.ToolTip>
                <Grid Width="12" Height="12" IsHitTestVisible="False">
                    <Path Data="{StaticResource Icon.WindowMaximize}"
                          Style="{StaticResource IconBase}"
                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                </Grid>
            </Button>

            <!-- Close -->
            <Button Command="{Binding CloseCommand}" 
                    Style="{DynamicResource CaptionCloseButtonStyle}"
                    ToolTip="{DynamicResource Str_Tooltip_Close}">
                <Grid Width="12" Height="12" IsHitTestVisible="False">
                    <Path Data="{StaticResource Icon.WindowClose}" 
                          Style="{StaticResource IconBase}"
                          Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                </Grid>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
